<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Cut MDM licensing costs fast. MDM Cleanup Co. is your emergency MDM device deletion partner." />
  <title>MDM Cleanup Co. | Cut MDM Licensing Costs Fast</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

  <header>
    <h1>MDM Cleanup Co.</h1>
    <p>Cut your MDM licensing costs fast. Delete unused devices — the right way.</p>
  </header>

  <main>
    <section id="home" class="page-section">
      <div class="content" id="form-section">
        <h2>Request a Free Quote</h2>
        <p>Tell us how many devices you need removed and what MDM you use. We'll respond fast with pricing and next steps.</p>

        <form id="quoteForm" action="https://formspree.io/f/mzzvjykb" method="POST" onsubmit="handleFormSubmit(event)">
          <!-- Honeypot anti-spam field -->
          <label style="display:none;">Leave this field empty:
            <input type="text" name="website" autocomplete="off">
          </label>

          <label for="name">Your Name</label>
          <input type="text" id="name" name="name" required />

          <label for="email">Your Email</label>
          <input type="email" id="email" name="_replyto" required />

          <label for="mdm">Which MDM Are You Using?</label>
          <input type="text" id="mdm" name="mdm" required />

          <label for="devices">How Many Devices Need Deletion?</label>
          <input type="number" id="devices" name="device_count" required />

          <label for="message">Additional Notes (optional)</label>
          <textarea id="message" name="message" rows="4"></textarea>

          <!-- Google reCAPTCHA (no auto-submit) -->
          <div class="g-recaptcha" data-sitekey="6LfaCZwrAAAAAGfc4tDL6WIMPr1ejP0Ojdx2fjbs"></div>

          <button type="submit">Request Quote</button>
        </form>
      </div>
    </section>

    <section id="thanks" class="page-section" style="display:none">
      <div class="content">
        <h2>✅ Thank You!</h2>
        <p>We've received your request. Our team will be in touch shortly at the email you provided.</p>
        <button id="backButton">⬅️ Submit Another Request</button>
      </div>
    </section>
  </main>

  <footer>
    &copy; 2025 MDM Cleanup Co.
  </footer>

  <script>
  function handleFormSubmit(e) {
    e.preventDefault();

    const button = document.querySelector('#quoteForm button[type="submit"]');
    button.disabled = true;
    button.textContent = "Verifying...";

    // ✅ Verify reCAPTCHA token
    const token = grecaptcha.getResponse();
    if (!token) {
      alert("Please complete the CAPTCHA before submitting.");
      button.disabled = false;
      button.textContent = "Request Quote";
      return;
    }

    submitFormWithCaptcha(token);
  }

  async function submitFormWithCaptcha(token) {
    const form = document.getElementById('quoteForm');
    const data = new FormData(form);
    data.append('g-recaptcha-response', token);

    const button = form.querySelector('button[type="submit"]');
    button.textContent = "Submitting...";

    try {
      const response = await fetch(form.action, {
        method: "POST",
        body: data,
        headers: { "Accept": "application/json" }
      });

      console.log("Response status:", response.status);

      if (response.ok) {
        document.getElementById('form-section').style.display = 'none';
        const thanks = document.getElementById('thanks');
        thanks.style.display = 'block';
        thanks.scrollIntoView({ behavior: 'smooth' });
      } else {
        const text = await response.text();
        console.error("Formspree Error Response:", text);
        alert("Oops! Something went wrong. (Status " + response.status + ")");
        button.disabled = false;
        button.textContent = "Request Quote";
        grecaptcha.reset();
      }
    } catch (err) {
      console.error("AJAX Exception:", err);
      alert("Network error. Please try again.");
      button.disabled = false;
      button.textContent = "Request Quote";
      grecaptcha.reset();
    }
  }

  // ✅ Back Button Logic
  document.addEventListener('DOMContentLoaded', () => {
    const backBtn = document.getElementById('backButton');
    backBtn.addEventListener('click', () => {
      document.getElementById('thanks').style.display = 'none';
      document.getElementById('form-section').style.display = 'block';
      grecaptcha.reset();
      const button = document.querySelector('#quoteForm button[type="submit"]');
      button.disabled = false;
      button.textContent = "Request Quote";
      document.getElementById('form-section').scrollIntoView({ behavior: 'smooth' });
    });
  });
  </script>

</body>
</html>